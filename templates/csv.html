{% extends "base.html" %}
{% block content %}
 CSV upload page with persistence and student list 
<div class="row justify-content-center">
  <div class="col-12 col-xl-10">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h4 m-0">CSV Upload</h1>
      <div class="d-flex gap-2">
        <a class="btn btn-outline-primary btn-sm" href="{{ url_for('hero') }}">Hero</a>
        <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('home') }}">Single Student</a>
      </div>
    </div>

    {% if message %}
      <div class="alert alert-info">{{ message }}</div>
    {% endif %}

    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <form action="{{ url_for('csv_page') }}" method="POST" enctype="multipart/form-data" class="d-flex flex-wrap align-items-center gap-3">
          <input class="form-control" type="file" name="csv_file" accept=".csv" required />
          <button class="btn btn-primary" type="submit">Upload</button>
          {% if has_dataset %}
            <form action="{{ url_for('csv_clear') }}" method="POST" class="d-inline">
              <button class="btn btn-outline-danger" type="submit">Clear Dataset</button>
            </form>
          {% endif %}
        </form>
      </div>
    </div>

    {% if has_dataset %}
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div class="text-muted">
              Current file: <strong>{{ filename }}</strong>
            </div>
            <form action="{{ url_for('csv_clear') }}" method="POST" class="m-0">
              <button class="btn btn-outline-danger btn-sm" type="submit">Remove</button>
            </form>
          </div>

          <div class="table-responsive">
            <table class="table align-middle">
              <thead>
                <tr>
                  <th scope="col">Student ID</th>
                  <th scope="col">Name</th>
                  <th scope="col">Class</th>
                  <th scope="col" class="text-end">Action</th>
                </tr>
              </thead>
              <tbody>
                {% for s in students %}
                <tr>
                  <td>{{ s.id }}</td>
                  <td>{{ s.name }}</td>
                  <td>{{ s.cls }}</td>
                  <td class="text-end">
                    <a class="btn btn-sm btn-primary" href="{{ url_for('csv_student_analytics', student_id=s.id) }}">View analytics</a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

        </div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
